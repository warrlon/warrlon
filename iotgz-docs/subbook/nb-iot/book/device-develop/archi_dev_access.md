# NB-IoT设备接入流程概览

您可以使用NB-IoT物联网套件让您的设备快速入云。该过程分为两个阶段：

**第一阶段**：NB-IoT设备接入OneNET平台。

**第二阶段**：基于设备上传数据流的应用开发。

通过本部分内容，开发人员可以了解到NB-IoT设备接入OneNET平台以及进行应用开发的基本流程，设备接入详细流程请查看[NB-IoT设备接入开发指南](/book/device-develop/access.md)。

![pic](/images/LwM2M/NB物联网套件接入流程图.jpg)

<h3><table><tr><td bgcolor=#F2F2F2>第一阶段:</td></tr></table></h3>

设备接入OneNET平台的操作过程分为平台侧操作和设备侧操作。

#### 1、平台侧

如上图所示，在完成账户注册和登录之后，您可以在OneNET平台上[创建产品](/book/get-start/product&device/createProduct.md)，产品相当于某一类设备的集合。

在创建的产品中，您可以进一步[添加设备](/book/get-start/product&device/createDevice.md)，一个产品下可以添加成百上千个设备，这些设备具有相同的功能。

#### 2、设备侧

如上图所示，终端设备在接入OneNET平台之前，您需要进行设备开发，即在设备侧完成由OneNET平台提供的基础通信套件SDK的移植工作。 

&ggg; 在实际接入中，主流的接入方式为：

终端设备搭载已经实现接入OneNET平台的NB-IoT模组，用户需要调用模组厂商提供的AT指令完成对资源的操作，终端设备通过NB-IoT模组和NB-IoT基站以及核心网等网元连接，实现和OneNET平台进行交互。

&ggg; 若您是模组厂商，需要移植接入OneNET平台的SDK，请[点击此处](/book/device-develop/get_SDK.md)。

#### 3、设备接入OneNET平台

终端设备搭载NB-IoT模组以及实现其它业务功能后，终端设备与OneNET的交互具体流程如下图步骤① ~ ⑬所示，用户只需完成其中终端设备侧的操作步骤即可。

![pic](/images/LwM2M/设备和平台交互流程.jpg)

完成上述步骤后，NB-IoT通信模组已经成功实现与OneNET平台的对接，并且设备通过通信模组封装的相应AT指令能向平台上传数据，同时模组也能接收平台下发的命令。

> 说明:订阅和discover是可选操作，用户设备可以根据是否收到“ read3_0 ”为标准判断订阅和discover成功与否，进一步判断注册是否成功。


#### 4、使用NB-IoT接入服务
用户可以通过OneNET平台的“**开发者中心**”进入“**NB-IoT物联网套件**”，对设备进行管理。

<h3><table><tr><td bgcolor=#F2F2F2>第二阶段:</td></tr></table></h3>

设备接入OneNET平台后，设备数据可以直接上报到OneNET平台。进一步，企业应用与OneNET平台之间通过HTTPS/HTTP请求/应答的方式实现数据交互。

&ggg; 基本过程为：

1）OneNET平台为企业应用提供封装好的API接口；

2）企业应用平台通过调用这些API接口完成对OneNET平台的读写执行以及设备管理请求；

3）OneNET平台将相应的指令请求发送到终端设备；

4）OneNET平台接收到终端设备响应的数据及设备信息；

5）OneNET平台将数据及设备信息推送到应用平台，完成应答。

企业应用接入OneNET平台的开发流程如下图所示：

![pic](/images/LwM2M/应用开发流程.jpg)

 **1. 企业应用与OneNET平台实现数据交互的前提是：**

用户已在OneNET平台创建了NB-IoT设备，平台上的设备有对应的真实设备且能正常上报数据。

**2. 开发流程：**

1）用户已经开发并部署了OneNET平台验证接入的程序。

企业应用平台接入验证程序工作流程如下：

&triangleright; OneNET平台完成对第三方开发平台的配置后，向企业应用平台发起URL&Token验证；

&triangleright; 接入验证程序对平台发送的验证参数进行验证；

&triangleright; 验证通过后，企业应用平台向OneNET平台返回验证消息；

&triangleright; OneNET平台收到验证消息后，说明企业应用平台与OneNET平台已建立连接。

2）在OneNET平台正确配置了企业应用数据接收的地址（URL） 、Token 以及其它参数。[点击此处](/book/manual/httppush.md)了解详细的配置过程。

3）测试数据是否能正确推送。

**3. 能力及应用扩展**

&diamond; 规则引擎：

用户可以自定义数据筛选规则，转换数据格式，为用户提供自定义消息清洗、消息分发能力，用户可通过规则引擎对接OneNET更多增值服务，快速实现服务扩展。

&diamond; 数据存储：

平台提供设备数据存储能力，便于用户进行设备海量数据存储与查询。

&diamond; HTTP推送：

平台以HTTPS/HTTP POST请求形式向企业应用平台注册地址推送数据，推送数据相关信息以JSON串的形式置于 HTTPS/HTTP请求中的 body 部分。企业应用平台在接收数据时，会接收到数据的明文消息或者密文消息。 

&diamond; 消息队列MQ：

该服务为用户提供高安全、高稳定性、高可用的消息获取能力。MQ可搭配物联网套件形成具有设备接入、设备通信、设备消息分发能力的高效解决方案。

&diamond; 应用编辑器：

通过OneNET应用编辑器，用户可以方便快捷地实现OneNET平台上的设备数据流可视化。

&diamond; 设备管理DMP：

机卡管理、远程升级、位置查询等。


