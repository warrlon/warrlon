# 版本记录（2019-05）

## OneNET v4.0.3 -2019.05.09

#### 1 NB-IoT物联网套件

- 1、新增农业自定义的object
- 2、缓存命令新增功能：命令结果保存期限为180天；缓存命令api增加了剩余重试次数（remain字段）功能
- 3、Apikey和accesskey查看需短信验证
- 4、取消每次读4_0的资源含cellid、网络信号强度网络承载着，仅FOTA前读取
- 5、备份设备的外部接口上线
- 6、资源列表更新成功后再擦除原资源列表的功能
- 7、根据IMEI号查询设备信息的接口，增加是否订阅成功的状态
- 8、和物消息转发服务：对来源为和物产品的消息转发到和物平台
- 9、修复删除固件版本提示语错误
- 10、缓存命令的bug修复：设备删除后推送结果中包含之前绑定的设备id的bug
- 11、修复NB fota服务，在断点续传时的空指针异常，导致升级中断的问题
- 12、authinfo不允许修改IMEI 的bug；
- 13、auth_code编辑的bug；
- 14、NB的升级和通用OTA，修改页面上的联系人
- 15、删除设备bug修复，再次用这个IMEI号注册，还能看到该IMEI号下的资源列表的bug

#### 2 其他协议及通用服务

- 1、EDP修复日志敏感词问题
- 2、API微服务化改造

#### 3 OneNET Video	

- 1.新上线视频能力运管系统
- 2.新增grpc消息中间件
- 3.修改部分通用配置，由配置文件改为apollo配置
- 4.优化通道在线状态查询方式，新增加通道在线服务器，直接查询通道的在线状态
- 5.新增手动录制API
- 6.新增存储操作API
- 7.优化open-api，以适应视频运管平台 视频统计对业务表的调整影响

#### 4 OneNET LBS

- 1、新增LBS线上计费功能

#### 5 OneNET View

- 1.修正MySQL Client Driver版本不兼容的问题（版本由5.1.46为5.1.6）
- 2.增加分布式文件本地缓存策略，采用LRU机制（过期时间设置为1小时）
- 3.增加集群各节点本地缓存同步机制（项目、数据源、数据集），通过redis pub/sub机制实现
- 4.修正自定义字段中+－*/等操作异常问题
- 5.修正日期过滤异常问题
- 6.解决聚合函数（不重复计数）数据查询异常问题
- 7.增加建立数据解析过程中，明确部分异常提示
- 8.增加nginx缓存配置策略（缓存期设置为1天）
- 9.增加nginx多级代理情况下，获取不到用户真实IP，导致ip_hash到一台服务器问题
- 10.修正部分图表样式配置
- 11.修正自定义公式例如显示为null的问题，时间过滤条件出现undefine问题
- 12.优化数据解析配置页面滚动条，让用户能看见滚动条
- 13.数据解析列表数据删除的情况下，条目记录的序号没有变化。
- 14.数据集编辑页面切到项目列表再切回来，数据集页面数据不显示问题。
- 15.内置数据源中，日期过滤异常问题。
- 16.案例文档集成进帮助手册。
- 17.联动的两个表删除其中一个后，联动标识图标还在。
- 18.自定义公式增加没有操作符的校验异常。

#### 6 开发者中心

- 1、新增数据点导出功能
- 2、图表自适应，目前产品概况、数据流展示、设备管理DMP-设备概览页面中的调整窗口尺寸时，表格新增自适应
- 3、触发器列表新增触发器id
- 4、选择数据流时新增交互信息
- 5、设备下发命令板块命令导出提示优化
- 6、产品鉴权信息短信验证后查看


## OneNET v4.0.4 -2019.05.16

#### 1 其他协议及通用服务

- 1、TCP透传服务对接Apollo
- 2、API微服务化改造

#### 2 OneNET SMS

- 1、短信服务2.0上线

## OneNET v4.0.5 -2019.05.23

#### 1 NB-IoT物联网套件

- 1、自动发现的开关功能和手动发现
- 2、IMEI校验规则加强（页面&API）
- 3、设备列表增加订阅状态
- 4、http推送增加提示文字
- 5、离线命令的valid_time和expired_time时间精度由当前的秒调整至毫秒，timeout时间调整为5-40s
- 6、水表低功耗产品白名单配置的后台页面

#### 2 OneNET SMS

- 1、修改签名和模板长度限制

#### 3 OneNET DMP

- 1、通用OTA设备管理、群组管理跳转地址修改
- 2、通用OTA固件升级时上传的包，不能包含中文
- 3、通用OTA南向接口性能优化

#### 4 开发者中心

- 1、修复开发者中心产品列表删除产品下发验证码时,未验证该产品是否属于当前用户的bug

## OneNET v4.0.6 -2019.05.29

#### 1 NB-IoT物联网套件

- 1、修复页面IMEI编辑验证提示错误的问题
- 2、修复新建NB产品的FOTA没有读取版本号的问题，上线后平台主动读3/0资源
- 3、NB的FOTA红石通道南向服务的redis设置密码（原内部数据库无密码）

#### 2 其他协议及通用服务

- 1、创建/更新设备API，删除auth_info只能为数字/英文字母的限制

#### 3 OneNET SMS

- 1、短信签名绑定特征码功能