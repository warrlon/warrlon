<h1>检测设备升级任务</h1>

请求方式：**GET**

URL: http(s)://ota.heclouds.com/ota/south/check

>设备处于“待升级”，“下载中”，“升级中”状态时，使用此API可以返回任务信息。

[我只想看示例！！！](#1)

#### http头部 
参数名称 | 格式 | 是否必须 | 说明
:- | :- | :- | :- 
Content-Type | string | 是 | 必须为application/json
Authorization | string | 是 | 安全鉴权信息


#### http请求参数
参数名称 | 格式 | 是否必须 | 说明
:- | :- | :- | :- 
dev_id | string | 是 | 设备id
manuf | string | 是 | 厂商名称，见附表
model | string | 是 | 模组型号，见附表
type | int | 是 | 任务类型，1代表FOTA任务，2代表SOTA任务
version | string | 是 | 版本信息
signals | int | 否 | 信号强度
powers | int | 否 | 剩余电量百分比
cdn | boolean | 是 | 设备支持域名解析请选择true，若设备不支持域名解析请选择false

#### 返回参数
参数名称 | 格式 |  说明
:- | :- | :- 
errno | int | 调用错误码，详见错误码说明
error | string | 错误描述，为"succ"表示调用成功
data | json | 接口调用成功之后返回的设备相关信息，见data描述表

#### data描述表
参数名称 | 格式 | 说明
:- | :- | :- 
target | string | 升级任务的目标版本
token | string | 文件地址 ip:port/ota/download/{token}
size | int | 文件大小
signal | int | 任务在大于该信号下进行
power | int | 任务在大于该电量下进行
retry | int | 重试次数
interval | int| 重试间隔
md5 | string | 升级文件的md5码
ipPort | string | 拉取升级包的ip地址
type | int | 1:完整包，2：差分包

#### SOTA的厂商、模组对照表

|芯片平台|	芯片型号|	厂商编号|	芯片编号|
|:-|:-|:-|:-|
|乐鑫|	ESP32	|101|	10101|
|nordic	|nrf52832|	102	|10201|
|兆易|	GD32|	103|	10301|
|其他	|其他	|100|	10001|

#### FOTA的厂商、模组对照表

|厂商名称	|模组型号|	厂商编号|	模组编号|
|-|-|-|-|
|中国移动|	 M5330-A|	001|	00101|
|中国移动|	M5330	|	001|00102|
|中国移动|	M5312	|	001|00103|
|中国移动|	M5313	|	001|00104|
|中国移动|	S5601	|	001|00105|
|中国移动|M5310-A	|	001|00106|
|中国移动|	M5310	|	001|00107|
|中国移动|	M5311	|	001|00108|
|中国移动|	M5330-GNSS	|	001|00109|
|中国移动|	M5330-STD	|	001|00110|
|零零智能|	N256|	002	|00201|
|利尔达|	NB86-G	|003|	00301|
|利尔达|	NB08-01|003|	00302|
|u-blox	|SARA-N200|	004	|00401|
|锐捷网络	|RG-NB6118	|005|	00501|
|锐捷网络	|RG-NB6210	|005|	00502|
|上海稳恒|	WH-NB71	|006|	00601|
|上海稳恒|WH-NB73	|006|	00602|
|信位通讯|	SN12_B8|	007|	00701|
|中兴通讯|	ZM8300|	008|	00801|
|中兴通讯|ZM8301	|008|	00802|
|有方科技	|N20	|009|	00901|
|普创天信|	T1|	010|01001|
|普创天信|	T101	|	010|	01002|
|普创天信|	T106	|	010|	01003|
|桑锐电子|	NH01A|	011|	01101|
|芯讯通|	SIM7000C|	012|	01201|
|芯讯通|	SIM7000C-N	|	012|	01202|
|芯讯通|	SIM7020C|	012|		01203|
|芯讯通|	SIM7030	|	012|	01204|
|移柯通信|	L620|	013|	01301|
|移远通信|	BC28	|014	|01401|
|移远通信|	BC68	|014	|	01402|
|移远通信|	BC35-G	|014	|	01403|
|移远通信|	BC95-G	|014	|	01404|
|移远通信|	BC26	|014	|	01405|
|移远通信|	BC95-B8	|014	|	01406|
|云程科技|	CFB-608-B8|	015	|01501|
|云程科技|	CFB-609	|	015	|	01502|
|骐俊物联|	ML5530	|016|	01601|
|广和通|	N700-CN	|017|	01701|
|东信和平|	NBM20	|018	|01801|
|吴通集团	|WT208|	019|	01901|
|高新兴物联|	ME3616|	020	|02001|
|新华三	|IM2209|	021|	02101|
|中科联合|	CT-M201|	022	|02201|
|中科联合|	CT-M202	|	022	|	02202|
|四川爱联|	AI-NB15|	023|	02301|
|九联科技|	UNB100-G|	024	|02401|
|朝歌科技|	S-ModNB00A|	025	|02501|
|小瑞科技|	N100|	026	|02601|
|中怡数宽|	TPB23|	027	|02701|
|中怡数宽|	TPB40-8|	027	|		02702|
|中怡数宽|	TPB41|	027	|		02703|
|光宝科技	|WNB301H|	028|	02801|
|欧智通	|3115F-R|	029|	02901|
|龙尚科技|	A9600-R2|	030|	03001|
|灵慧科技|	LT150|	031	|03101|
|其他|其他|	000	|00001|

#### 错误码说明

<table>
<tr><th width="20%">错误码</th><th>说明</th></tr>
<tr><td>0</td><td>设备存在升级任务,token值为文件映射路径（设置有效期,详情见设计文档），token有效期2天。</td></tr>
<tr><td>1</td><td>鉴权失败（当设备不存在时）。</td></tr>
<tr><td>2</td><td>请求参数错误。</td></tr>
<tr><td>7</td><td>OneNET内部错误。</td></tr>
<tr><td>8</td><td>检测失败,设备存在升级任务,但是因为manuf或者model不一致,会将任务进入失败状态。</td></tr>
<tr><td>9</td><td>检测失败,设备存在升级任务,但是因为version不一致导致任务进入失败状态（差分包升级才有此流程）。</td></tr>
<tr><td>11</td><td>没有检测到升级任务，设备不存type（fota/sota）对应的升级任务。</td></tr>
<tr><td>27</td><td>版本号格式错误（版本号只能包括：[a-zA-Z0-9_\\-.],长度为[1, 20]）。</td></tr>
</table>

#### 说明

1、检查任务时如果可以检测到设备状态（待升级，升级中）的任务，则返回token等响应参数；

2、如果设备没有升级的任务，会判断是否存在自动添加策略，如果满足自动添加策略，会给设备新增一个任务并返回任务信息。

<h4 id="1">请求参数示例</h4>

```json
{
	"dev_id": 6523,    //必填，设备ID
	"manuf": "中国移动",//必填,厂商名称对应的代码
	"model": "M5310",  //必填,模组名称对应的代码
	"type": 1,         //1:fota任务,2:sota任务
	"version":"1.2" ,  //必填,设备当前版本号
	"signals": 10,     //可选，信号强度
	"powers":30,       //可选，电量剩余值百分比
	"cdn": true        //是否返回拉取升级包ip
	
}
```

#### 返回示例

```json
{
	"errno": 0,
	"error": "succ",
	"data": {
		"target":"1.2", // 升级任务的目标版本
        "token":"ota_5hc95SFeo5xJEnaNrste",//文件地址 ip:port/ota/download/{token}
        "size":123, //文件大小
        "signal":12,//任务在大于该信号下进行
        "power":90, //任务在大于该电量下进行
        "retry":10, //重试次数
        "interval":90, //重试间隔
        "md5":"dfkdajkfd", //升级文件的md5
        "ipPort":"172.19.3.3",//拉取升级包的ip地址
		"type":1 // 1:完整包，2：差分包
	}
}
```

