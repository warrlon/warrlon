# 升级操作流程：

step1.	注册/登录OneNET平台https://open.iot.10086.cn

step2.	点击设备管理模块，进入DMP管理模块。
![dmp首页](/images/OTA/startOTA.png)

step3.	左侧导航栏选择OTA升级，点击FOTA升级。
![ota](/images/OTA/OTA.png)
 
step4.	选择固件管理，点击添加固件版本，在添加固件对话框中，输入固件信息，上传固件等信息。
![ota](/images/OTA/addpakge.png)
 
 >  说明：

		a）根据设备使用的模组选择对应的厂商名称、模组型号（如在下拉框中没有你所使用的，可以联系18883296390或者选择其他）；
		b）目标版本，固件版本号，仅支持英文字母、数字、点号、连接符和下划线，长度在1~50字符；
		c）版本整包：可选，完整包名不能包含中文字符。
		
![ota](/images/OTA/managepakge.png)
 
step5.	添加差分包，选择在某个固件包下单击“添加差分包”，在添加差分包对话框，选择初始版本号，上传升级包。
![ota](/images/OTA/adddf.png)

> 说明：（差分包升级的情况下）

		a）初始版本：需要升级的设备当前的版本号；
		b）目标版本：设备升级成功后的版本号;
		c）上传升级包：如果用户手里有差分包，可以选择直接上传（此时设备端拿到差分包，还原成完整包需要用户自行实现）；
		如果用户没有差分包，可以选择在线差分，此时设备下载升级包后需要使用OneNET平台提供SDK进行差分还原。

![ota](/images/OTA/managedfpakge.png)
 
step6. 添加升级任务：选择升级任务管理，单击“添加升级任务”，在添加升级任务对话框中，选择需要升级的设备、升级包和升级策略等信息。
![ota](/images/OTA/addtask.png)

> 说明：

		a)升级名称：支持中文、数字、字母、空格已经-！@#￥%……&*等符号；
		b)选择升级包：这里可以选择完整包（初始版本为“Before Version”），也可以选择差分包（初始版本非“Before Version”）；
		c)下拉选择升级的产品；
		d)选择设备，可以选择指定的设备或群组；
		e)下拉选择信号强度：这个数值将在检查任务成功返回给设备，有设备来决定当前设备信号是否满足升级要求；
		f)下拉剩余电量百分比：这个数值将在检查任务成功返回给设备，有设备来决定当前设备电量是否满足升级要求；
		g)重试策略：这个数值将在检查任务成功返回给设备，有设备来决定当前设备判断是否进行重试；
		h)执行策略：有启动执行和自定义时间两个选项，启动执行需要手动点击启动任务；自定义时间是指定时间，到时候是自动启动任务；
		i)截止时间：任务终止时间，当任务截止时间到达是，将终止所有设备的升级。

step7.	点击启动任务：如果在添加升级任务时，选择的执行策略为“启动执行”，需要在页面点击启动任务。
![ota](/images/OTA/sarttask.png)
到此已经完成升级任务的创建，下一步就需要设备来检测升级任务，拉取升级包进行升级等操作。

## 设备端操作
下面的操作是设备端进行（南向）

设备与平台采用HTTP协议RESTful标准格式进行数据交互，接口通过Authorization来鉴权，Authorization获取见[安全鉴权](/book/manual/auth.md)章节。

step8.	检测升级任务[检测升级任务接口](/book/develop/south-API/1task.md)


step9. token校验[token校验接口](/book/develop/south-API/2token.md)

	如果上一步成功检查到升级任务，得到任务和升级包相关信息，设备拉取升级包时，OneNET平台通过token进行校验，并且上一步返回的token只有48小时的有效期，所以这里客户在使用时最好提前校验一下token是否有效，如下接口为校验接口：


step10.	拉取升级包[拉取升级包接口](/book/develop/south-API/3port.md)

	token检测成功，那下一步就从平台获取升级包，如下接口完成升级包下载，支持分片下载。


step11.	上报升级状态[上报升级状态接口](/book/develop/south-API/4state.md)

	在升级的过程中，设备需要主动上报升级状态，使用如下接口




